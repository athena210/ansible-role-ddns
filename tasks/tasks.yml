---

- name: Extract ddns_afraid package
  ansible.builtin.unarchive:
    src: files.tgz
    dest: /

- name: Config dir permission
  ansible.builtin.file:
    state: directory
    path: /etc/ddns_afraid_org.d
    mode: "0750"

- name: Domain config
  ansible.builtin.copy:
    content: "DDNS_URL='http://sync.afraid.org/u/{{ ddns_afraid_key }}/'\n"
    dest: "/etc/ddns_afraid_org.d/{{ ddns_afraid_domain }}.conf"
    mode: "0640"

- name: Enable service and ensure it is not masked
  ansible.builtin.systemd_service:
    name: ddns-afraid-org.service
    enabled: true
    masked: false
    daemon_reload: true

- name: Enable timer
  ansible.builtin.systemd_service:
    name: ddns-afraid-org.timer
    state: started
    enabled: true

- name: Restart service
  ansible.builtin.systemd_service:
    state: restarted
    # daemon_reload: true
    name: ddns-afraid-org.service
