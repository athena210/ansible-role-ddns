---

- name: Check whether your OS is supported
  ansible.builtin.assert:
    quiet: true
    that:
      - ansible_os_family | lower in ddns__os_supperted | list
    fail_msg: Your OS is not supported

- name: Extract ddns_afraid package
  ansible.builtin.unarchive:
    src: files.tgz
    dest: /

- name: Config dir permission
  ansible.builtin.file:
    state: directory
    path: /etc/ddns.d
    mode: "0750"
  notify: handler_restart_ddns

- name: Add domains
  ansible.builtin.template:
    src: domain.conf.j2
    dest: "/etc/ddns.d/{{ dom.domain | b64encode(urlsafe=true) }}.conf"
    mode: "640"
  vars:
    ddns__url: "{{ dom.url }}"
    ddns__domain: "{{ dom.domain }}"
  loop: "{{ ddns__domains }}"
  loop_control:
    label: "{{ dom.domain }}"
    loop_var: dom
  notify: handler_restart_ddns
